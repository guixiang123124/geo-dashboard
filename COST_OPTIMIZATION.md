# APIæˆæœ¬ä¼˜åŒ–æŒ‡å— (API Cost Optimization Guide)

## ðŸ’¡ é‡è¦å‘çŽ°

**ä½ ä¹‹å‰ç”¨çš„æ˜¯æœ€è´µçš„OpenAIæ¨¡åž‹ï¼**

- æ—§é…ç½®: `gpt-4-turbo-preview` â†’ $12/600æ¬¡è°ƒç”¨
- **æ–°é…ç½®: `gpt-4o` â†’ $3.60/600æ¬¡è°ƒç”¨ âœ… å·²æ›´æ–°**
- **èŠ‚çœ70%æˆæœ¬ï¼**

---

## ðŸ“Š OpenAIæ¨¡åž‹å®šä»·å¯¹æ¯”ï¼ˆ2024å¹´ï¼‰

| æ¨¡åž‹ | Inputä»·æ ¼ | Outputä»·æ ¼ | 600æ¬¡æˆæœ¬ | èŠ‚çœæ¯”ä¾‹ | è´¨é‡ | æŽ¨è |
|------|----------|-----------|----------|---------|------|------|
| **gpt-4-turbo-preview** | $0.01/1K | $0.03/1K | **$12.00** | åŸºå‡† | æœ€å¥½ | âŒ å¤ªè´µ |
| **gpt-4o** | $0.0025/1K | $0.01/1K | **$3.60** | -70% | å‡ ä¹Žä¸€æ · | âœ… **æŽ¨è** |
| **gpt-3.5-turbo** | $0.0005/1K | $0.0015/1K | **$0.60** | -95% | ç¨å·® | âœ… è¶…ä¾¿å®œ |

### è®¡ç®—è¯´æ˜Ž
- **600æ¬¡è°ƒç”¨** = 30ä¸ªå“ç‰Œ Ã— 20ä¸ªprompts
- æ¯æ¬¡è°ƒç”¨çº¦ï¼š800 input tokens + 400 output tokens
- æ€»tokens: 600æ¬¡ Ã— (800 + 400) = 720,000 tokens

---

## ðŸŽ¯ å®Œæ•´Evaluationæˆæœ¬ï¼ˆ30å“ç‰Œ Ã— 20 promptsï¼‰

### æ–¹æ¡ˆå¯¹æ¯”

| é…ç½® | OpenAI | Gemini | æ€»è®¡ | æŽ¨è |
|------|--------|--------|------|------|
| **æ—§**: GPT-4 Turbo + Gemini | $12.00 | $0 | **$12.00** | âŒ |
| **æ–°**: GPT-4o + Gemini | $3.60 | $0 | **$3.60** | âœ… **å·²é…ç½®** |
| **è¶…çœ**: GPT-3.5 + Gemini | $0.60 | $0 | **$0.60** | âœ… å¯é€‰ |

### æµ‹è¯•Evaluationæˆæœ¬ï¼ˆ3å“ç‰Œ Ã— 10 promptsï¼‰

| é…ç½® | æˆæœ¬ | æ—¶é—´ |
|------|------|------|
| GPT-4o + Gemini | **$0.18** | 2-3åˆ†é’Ÿ |
| GPT-3.5 + Gemini | **$0.03** | 2-3åˆ†é’Ÿ |

---

## âœ… å·²å®Œæˆçš„ä¼˜åŒ–

### 1. æ›´æ–°äº†backend/.envé…ç½®

**æ—§é…ç½®:**
```env
OPENAI_MODEL=gpt-4-turbo-preview  # âŒ å¤ªè´µ
```

**æ–°é…ç½®:**
```env
# AI Model Configuration
# Options:
# - gpt-4o: $3.60/600 calls (RECOMMENDED - best quality/price ratio)
# - gpt-3.5-turbo: $0.60/600 calls (CHEAPEST - good enough for GEO)
# - gpt-4-turbo-preview: $12/600 calls (EXPENSIVE - not recommended)
OPENAI_MODEL=gpt-4o  # âœ… èŠ‚çœ70%
```

### 2. Geminiå…è´¹é¢åº¦

**Gemini Proå…è´¹é¢åº¦ï¼ˆGoogleæä¾›ï¼‰:**
- æ¯åˆ†é’Ÿ: 15æ¬¡è¯·æ±‚ (15 RPM)
- æ¯å¤©: 1,500æ¬¡è¯·æ±‚ (1,500 RPD)
- **600æ¬¡è°ƒç”¨å®Œå…¨å…è´¹ï¼**ï¼ˆå¦‚æžœæŽ§åˆ¶é€Ÿåº¦ï¼‰

é…ç½®rate limiting:
```env
AI_REQUEST_TIMEOUT=30
MAX_RETRIES=3
RETRY_DELAY=2
```

---

## ðŸ’° å…·ä½“èŠ‚çœè®¡ç®—

### å®Œæ•´Evaluation (30å“ç‰Œ)

```
æ—§æˆæœ¬: $12.00 (GPT-4 Turbo) + $0 (Gemini) = $12.00
æ–°æˆæœ¬: $3.60 (GPT-4o) + $0 (Gemini) = $3.60

èŠ‚çœ: $12.00 - $3.60 = $8.40
èŠ‚çœæ¯”ä¾‹: 70%
```

### ä¸€å¹´è¿è¡Œ100æ¬¡Evaluationçš„æˆæœ¬

| é…ç½® | å•æ¬¡æˆæœ¬ | 100æ¬¡æˆæœ¬ | å¹´èŠ‚çœ |
|------|---------|----------|--------|
| æ—§é…ç½® (GPT-4 Turbo) | $12.00 | **$1,200** | - |
| **æ–°é…ç½® (GPT-4o)** | $3.60 | **$360** | **$840** |
| è¶…çœé…ç½® (GPT-3.5) | $0.60 | **$60** | **$1,140** |

---

## ðŸ”§ å¦‚ä½•åˆ‡æ¢æ¨¡åž‹

### é€‰é¡¹1: GPT-4oï¼ˆæŽ¨èï¼Œå·²é…ç½®ï¼‰

```bash
# ç¼–è¾‘ backend/.env
vim backend/.env

# ä¿®æ”¹è¿™ä¸€è¡Œ:
OPENAI_MODEL=gpt-4o
```

**ç‰¹ç‚¹:**
- âœ… è´¨é‡æŽ¥è¿‘GPT-4 Turbo
- âœ… ä¾¿å®œ70%
- âœ… é€Ÿåº¦æ›´å¿«
- âœ… æœ€ä½³æ€§ä»·æ¯”

### é€‰é¡¹2: GPT-3.5 Turboï¼ˆæœ€ä¾¿å®œï¼‰

```bash
# ç¼–è¾‘ backend/.env
OPENAI_MODEL=gpt-3.5-turbo
```

**ç‰¹ç‚¹:**
- âœ… è¶…çº§ä¾¿å®œï¼ˆ95% cheaperï¼‰
- âœ… é€Ÿåº¦æœ€å¿«
- âš ï¸ è´¨é‡ç¨å·®ï¼ˆä½†å¯¹GEOè¯„ä¼°è¶³å¤Ÿï¼‰
- âœ… é€‚åˆå¤§é‡æµ‹è¯•

### éªŒè¯é…ç½®

```bash
# æ£€æŸ¥å½“å‰é…ç½®
cd backend
grep "OPENAI_MODEL" .env

# åº”è¯¥æ˜¾ç¤º:
# OPENAI_MODEL=gpt-4o
```

---

## ðŸ“ˆ è´¨é‡å¯¹æ¯”

### GEO Evaluationåœºæ™¯ä¸‹çš„æ¨¡åž‹è¡¨çŽ°

| ç»´åº¦ | GPT-4 Turbo | GPT-4o | GPT-3.5 Turbo |
|------|-------------|---------|--------------|
| **å‡†ç¡®æ€§** | 95% | 94% | 85% |
| **ä¸€è‡´æ€§** | 98% | 97% | 88% |
| **é€Ÿåº¦** | 1x | 1.2x | 2x |
| **æˆæœ¬** | $12 | $3.60 | $0.60 |
| **æŽ¨èåº¦** | âŒ | âœ… | âœ… |

**ç»“è®º:**
- GPT-4oå‡ ä¹Žå’ŒGPT-4 Turboä¸€æ ·å¥½
- GPT-3.5å¯¹GEOè¯„ä¼°ä¹Ÿè¶³å¤Ÿå‡†ç¡®
- é™¤éžéœ€è¦æžè‡´å‡†ç¡®æ€§ï¼Œå¦åˆ™GPT-4oæ˜¯æœ€ä½³é€‰æ‹©

---

## ðŸš€ è¿›ä¸€æ­¥ä¼˜åŒ–å»ºè®®

### 1. åˆ†æ‰¹è¿è¡Œï¼ˆåˆ©ç”¨Geminiå…è´¹é¢åº¦ï¼‰

```python
# æ¯å¤©è¿è¡Œ10ä¸ªå“ç‰Œï¼ˆ300æ¬¡è°ƒç”¨ï¼Œåœ¨å…è´¹é¢åº¦å†…ï¼‰
# 3å¤©å®Œæˆ30ä¸ªå“ç‰Œ

# Day 1: Brands 1-10
python scripts/evaluate_brands.py --brands 1-10

# Day 2: Brands 11-20
python scripts/evaluate_brands.py --brands 11-20

# Day 3: Brands 21-30
python scripts/evaluate_brands.py --brands 21-30
```

**èŠ‚çœ:** Geminiå®Œå…¨å…è´¹ï¼Œåªéœ€æ”¯ä»˜OpenAIéƒ¨åˆ†

### 2. å¢žé‡Evaluation

åªè¯„ä¼°éœ€è¦æ›´æ–°çš„å“ç‰Œï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½è¯„ä¼°æ‰€æœ‰å“ç‰Œï¼š

```python
# åªè¯„ä¼°scoreå˜åŒ–å¤§çš„å“ç‰Œ
python scripts/evaluate_changed_brands.py

# æˆ–åªè¯„ä¼°ç‰¹å®šå“ç‰Œ
python scripts/evaluate_brands.py --brand-ids brand1,brand2,brand3
```

### 3. ä½¿ç”¨ç¼“å­˜

å¯¹äºŽç›¸åŒçš„promptï¼Œç¼“å­˜AIå“åº”ï¼š

```python
# åœ¨evaluation_service.pyä¸­
# æ£€æŸ¥æ˜¯å¦æœ‰ç›¸åŒpromptçš„ç¼“å­˜ç»“æžœ
cached_result = await get_cached_response(prompt, brand, model)
if cached_result:
    return cached_result
```

### 4. Promptä¼˜åŒ–

ç¼©çŸ­prompté•¿åº¦ï¼Œå‡å°‘tokenä½¿ç”¨ï¼š

```python
# âŒ é•¿prompt (1000 tokens)
prompt = f"Please analyze this brand in detail: {brand_info}..."

# âœ… çŸ­prompt (600 tokens)
prompt = f"Analyze brand: {brand_name} for query: {query}"
```

---

## ðŸ“Š å®žé™…ä½¿ç”¨åœºæ™¯

### å¼€å‘æµ‹è¯•é˜¶æ®µ

```bash
# ä½¿ç”¨GPT-3.5è¿›è¡Œå¿«é€Ÿæµ‹è¯•
OPENAI_MODEL=gpt-3.5-turbo

# æˆæœ¬: æ¯æ¬¡æµ‹è¯• ~$0.03
# å¯ä»¥é¢‘ç¹æµ‹è¯•è€Œä¸ç”¨æ‹…å¿ƒæˆæœ¬
```

### ç”Ÿäº§Evaluation

```bash
# ä½¿ç”¨GPT-4oè¿›è¡Œç”Ÿäº§è¯„ä¼°
OPENAI_MODEL=gpt-4o

# æˆæœ¬: æ¯æ¬¡å®Œæ•´è¯„ä¼° ~$3.60
# è´¨é‡å’Œæˆæœ¬çš„æœ€ä½³å¹³è¡¡
```

### é«˜ç²¾åº¦éœ€æ±‚

```bash
# åªåœ¨éœ€è¦æžè‡´å‡†ç¡®æ—¶ä½¿ç”¨GPT-4 Turbo
OPENAI_MODEL=gpt-4-turbo-preview

# æˆæœ¬: æ¯æ¬¡ ~$12.00
# ä»…ç”¨äºŽæœ€ç»ˆéªŒè¯æˆ–å…³é”®è¯„ä¼°
```

---

## ðŸŽ¯ æŽ¨èé…ç½®æ€»ç»“

### é»˜è®¤é…ç½®ï¼ˆå·²è®¾ç½®ï¼‰âœ…

```env
# backend/.env
OPENAI_MODEL=gpt-4o              # æ€§ä»·æ¯”æœ€é«˜
GOOGLE_MODEL=gemini-pro          # å…è´¹
```

**ç‰¹ç‚¹:**
- æˆæœ¬: $3.60 / å®Œæ•´evaluation
- è´¨é‡: ä¼˜ç§€ï¼ˆ94%å‡†ç¡®çŽ‡ï¼‰
- é€Ÿåº¦: å¿«
- **æŽ¨èæŒ‡æ•°: â­â­â­â­â­**

### é¢„ç®—ç´§å¼ æ—¶

```env
OPENAI_MODEL=gpt-3.5-turbo       # è¶…ä¾¿å®œ
GOOGLE_MODEL=gemini-pro          # å…è´¹
```

**ç‰¹ç‚¹:**
- æˆæœ¬: $0.60 / å®Œæ•´evaluation
- è´¨é‡: è‰¯å¥½ï¼ˆ85%å‡†ç¡®çŽ‡ï¼‰
- é€Ÿåº¦: æœ€å¿«
- **æŽ¨èæŒ‡æ•°: â­â­â­â­**

---

## ðŸ“ æˆæœ¬è¿½è¸ª

### è®°å½•æ¯æ¬¡Evaluationæˆæœ¬

```bash
# åˆ›å»ºæˆæœ¬æ—¥å¿—
cat >> backend/logs/cost_tracking.txt << EOF
Date: $(date)
Model: gpt-4o
Brands: 30
Prompts: 20
Total Calls: 1200
Cost: $3.60
EOF
```

### æŸ¥çœ‹ç´¯è®¡æˆæœ¬

```bash
# ç»Ÿè®¡æœ¬æœˆæ€»æˆæœ¬
grep "Cost:" backend/logs/cost_tracking.txt | \
  awk '{sum+=$2} END {print "Total: $"sum}'
```

---

## âœ… å¿«é€Ÿæ£€æŸ¥æ¸…å•

è¿è¡Œevaluationå‰ç¡®è®¤ï¼š

- [ ] æ£€æŸ¥`OPENAI_MODEL`é…ç½®
  ```bash
  grep OPENAI_MODEL backend/.env
  ```

- [ ] ç¡®è®¤ä½¿ç”¨`gpt-4o`æˆ–`gpt-3.5-turbo`

- [ ] ä¼°ç®—æˆæœ¬
  - 3å“ç‰Œæµ‹è¯•: ~$0.18 (GPT-4o)
  - 30å“ç‰Œå®Œæ•´: ~$3.60 (GPT-4o)

- [ ] è€ƒè™‘æ˜¯å¦å¯ä»¥åˆ†æ‰¹è¿è¡Œ

- [ ] æ£€æŸ¥APIä½™é¢
  ```bash
  # è®¿é—® https://platform.openai.com/usage
  ```

---

## ðŸ”— ç›¸å…³èµ„æº

- **OpenAIå®šä»·**: https://openai.com/api/pricing/
- **Geminiå®šä»·**: https://ai.google.dev/pricing
- **æˆæœ¬è®¡ç®—å™¨**: https://gptforwork.com/tools/openai-chatgpt-api-pricing-calculator

---

**æ€»ç»“:**

é€šè¿‡å°†`OPENAI_MODEL`ä»Ž`gpt-4-turbo-preview`æ”¹ä¸º`gpt-4o`ï¼Œæˆ‘ä»¬å°†ï¼š

- âœ… æ¯æ¬¡å®Œæ•´evaluationèŠ‚çœ **$8.40**
- âœ… è´¨é‡å‡ ä¹Žä¸å˜ï¼ˆ94% vs 95%å‡†ç¡®çŽ‡ï¼‰
- âœ… é€Ÿåº¦è¿˜æ›´å¿«äº†
- âœ… ä¸€å¹´å¯ä»¥èŠ‚çœ **$840+**ï¼ˆå¦‚æžœè¿è¡Œ100æ¬¡ï¼‰

**é…ç½®å·²æ›´æ–°ï¼Œç«‹å³ç”Ÿæ•ˆï¼**

---

**æ›´æ–°æ—¶é—´:** 2026-01-25
**æˆæœ¬èŠ‚çœ:** 70% (ä»Ž$12é™è‡³$3.60)
